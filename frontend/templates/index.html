<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Login | Esit Water</title>
<script src="https://kit.fontawesome.com/17e091a2b0.js" crossorigin="anonymous"></script>
 
<link rel="stylesheet" href="/static/css/styles.css"/>

<link rel="icon" href="/static/assets/logo.png" type="image/png"/>
</head>
<body>
<div class="card">
<div class="image-side">
 <img src="/static/assets/image1.jpg" alt="Water Flow" class="main-image"/>
 </div>

 <div class="form-side">
 <div class="title-with-logo">
<img src="/static/assets/logo.png" alt="Logo" class="title-logo">
<h1>Welcome Back</h1>
 </div>

<form id="login-form">
 <div class="form-group">
<input type="text" id="username" name="username" placeholder="Username" required/>
<i class="fas fa-user icon"></i>
 </div>

<div class="form-group">
 <input type="password" id="password" name="password" placeholder="Password" required/>
 <i class="fas fa-lock icon"></i>
 </div>

<button type="submit" class="btn">Login <i class="fas fa-sign-in-alt arrow-icon"></i></button>
</form>

<div id="message-container" class="message-container"></div>

<div class="divider">
<span>or continue with</span>
</div>

<div class="social-login">
 <button class="btn-social google">
<i class="fab fa-google"></i> Continue with Google
</button>
<button class="btn-social facebook">
<i class="fab fa-facebook-f"></i> Continue with Facebook
 </button>
 </div>
 <p class="signup-text">Don't have an account? <a href="/register.html">Sign Up</a></p>
</div>
 </div>

    <script>
    // ðŸ›‘ VERCEL DEPLOYMENT CHANGE: Define the absolute base URL for your deployed API
    const API_BASE_URL = 'https://coretech-backend.onrender.com'; // <--- ðŸ›‘ REPLACE THIS with your actual live backend URL
    
    // ðŸ›‘ VERCEL DEPLOYMENT CHANGE: Define absolute paths for dashboards
    // Ensure these match the paths to your dashboard files in your Vercel project structure (e.g., /dashboard.html)
    const ADMIN_DASHBOARD_URL = '/admin_dashboard.html'; 
    const USER_DASHBOARD_URL = '/dashboard.html'; 
    
    const loginForm = document.getElementById('login-form');
    const messageContainer = document.getElementById('message-container');

    function showMessage(message, type = 'error') {
        messageContainer.textContent = message;
        messageContainer.className = `message-container ${type}`;
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        showMessage('', 'hidden');

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        const data = {
            username: username,
            password: password
        };
        
        try {
            // ðŸ›‘ VERCEL FIX: Use the absolute API URL
            const response = await fetch(`${API_BASE_URL}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            const result = await response.json();

            if (response.ok) {
                localStorage.setItem('token', result.token);
                showMessage('Login successful! Redirecting...', 'success');

                // ðŸ›‘ VERCEL FIX: Use the absolute path constants for redirection
                if (result.is_admin){
                    window.location.href = ADMIN_DASHBOARD_URL; 
                } else {
                    window.location.href = USER_DASHBOARD_URL; 
                }
            } else {
                const message = result.error || 'Login failed. Please check your credentials.';
                showMessage(message);
            }
        } catch (error) {
            console.error('Network error:', error);
            showMessage('A network error occurred. Please check your connection and that the API is running.');
        }
    });
</script>
</body>
</html>